# .github/workflows/deploy.yml
# è¯¥æ–‡ä»¶æ˜¯github actionsçš„å·¥ä½œæµé…ç½®æ–‡ä»¶ï¼Œæ”¾åœ¨.github/workflowsç›®å½•ä¸‹
# è¯¥æ–‡ä»¶çš„ä½œç”¨æ˜¯è‡ªåŠ¨åŒ–éƒ¨ç½²VitePressé¡¹ç›®åˆ°GitHub Pages
# å·¥ä½œæµçš„åç§°ï¼Œå¦‚æœçœç•¥ï¼Œåˆ™ä½¿ç”¨å½“å‰æ–‡ä»¶å
name: FengLing Blog

# ä»å·¥ä½œæµç”Ÿæˆçš„å·¥ä½œæµè¿è¡Œçš„åç§°ï¼Œå¦‚æœçœç•¥ï¼Œåˆ™ä½¿ç”¨æäº¤æ—¶çš„commitä¿¡æ¯
run-name: FengLing Blog by @${{ github.actor }}

# è§¦å‘éƒ¨ç½²çš„æ¡ä»¶
on:
  # æ¯å½“ push åˆ° master åˆ†æ”¯æ—¶è§¦å‘éƒ¨ç½²
  push:
    tags:
      - "*"
    branches: 
      - master

# å½“å‰æµç¨‹è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯å¤šä¸ªã€‚[my_first_job]å°±æ˜¯ä¸€ä¸ªä»»åŠ¡
jobs:
  fengling-and-deploy:
    # ä»»åŠ¡çš„åç§°ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤my_first_job
    name: fengling-and-deploy

    # è¿è¡Œæ‰€éœ€è¦çš„è™šæ‹Ÿæœºç¯å¢ƒ
    runs-on: ubuntu-latest

    # æ¯ä¸ªä»»åŠ¡ä¸‹çš„è¿è¡Œæ­¥éª¤ï¼ŒçŸ­æ¨ªæ  - è¡¨ç¤ºä¸€ä¸ªæ­¥éª¤ï¼Œä»ä¸Šè‡³ä¸‹ä¾æ¬¡æ‰§è¡Œã€‚
    steps:
      # clone è¯¥ä»“åº“çš„æºç åˆ°å·¥ä½œæµä¸­
      - name: Checkout
        uses: actions/checkout@v4
        with:
          # "æœ€è¿‘æ›´æ–°æ—¶é—´"ç­‰ git æ—¥å¿—ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ‹‰å–å…¨éƒ¨æäº¤è®°å½•
          # fetch-depth: 0
          ref: "master"
      # å®‰è£…pnpm
      - name: Install pnpm
        run: |
          corepack enable
          corepack prepare pnpm@latest --activate
      # å®‰è£… Node ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          # é€‰æ‹©è¦ä½¿ç”¨çš„ node ç‰ˆæœ¬
          node-version: '20'

      # ä½¿ç”¨pnpmå®‰è£…ä¾èµ–
      - name: Install dependencies
        run: pnpm install
      # æ‰“åŒ…vitepressé¡¹ç›®
      - name: Build Site
        run: pnpm run docs:build
      # å°†æ‰“åŒ…ådisté‡Œçš„äº§ç‰©æäº¤åˆ°prodåˆ†æ”¯
      - name: Deploy for Github ğŸš€
        uses: JamesIves/github-pages-deploy-action@v4.4.1
        with:
          branch: prod
          folder: .vitepress/dist
          single-commit: true
          clean: true